<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ServiExpres | Chatea con Adrian</title>

  <!-- Fuente -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">

  <!-- n8n Chat CSS -->
  <link href="https://cdn.jsdelivr.net/npm/@n8n/chat/dist/style.css" rel="stylesheet" />

  <style>
    :root{
      --bg: #16213e;
      --card: rgba(255,255,255,0.07);
      --accent: #00AEEF;
      --white: #ffffff;
      --muted: rgba(255,255,255,0.85);
    }

    *{box-sizing:border-box;margin:0;padding:0}
    html,body{height:100%;width:100%;font-family:'Inter',system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial; background:var(--bg); color:var(--white); -webkit-font-smoothing:antialiased}

    header { padding: 28px 16px 6px; text-align:center; }
    header h1 { font-size:1.9rem; margin-bottom:6px; }
    header p { color:var(--muted); margin-bottom:6px; }

    main { max-width: 920px; margin: 18px auto; padding: 16px; display: grid; grid-template-columns: 1fr 380px; gap: 20px; align-items:start; width: calc(100% - 32px); }
    .left { background: var(--card); border-radius: 18px; padding: 20px; box-shadow: 0 8px 32px rgba(0,0,0,0.28); }
    .right { min-height: 140px; display:flex; align-items:center; justify-content:center; }

    .intro { line-height:1.6; color:var(--muted); margin-bottom: 12px; }
    .list { margin-top: 12px; }
    .list li { margin-bottom: 8px; padding-left: 20px; position: relative; color:var(--muted); }
    .list li::before { content: "‚úÖ"; position: absolute; left: 0; top: 0; }

    footer { text-align:center; color: rgba(255,255,255,0.7); margin: 18px 0 40px; font-size:0.95rem; }

    /* Card for chat container (the widget will inject itself) */
    .chat-card { border-radius: 14px; overflow: hidden; position: relative; background: transparent; min-height: 320px; display:flex; align-items:flex-end; }

    /* Mobile adjustments: stack columns */
    @media (max-width: 880px) {
      main { grid-template-columns: 1fr; }
      .right { order: -1; }
    }

    /* Force chat input visible on mobile (n8n widget classes) */
    .n8n-chat__footer, .n8n-chat__input, .n8n-chat__send { display:block !important; opacity:1 !important; }

    @media (max-width:600px) {
      .n8n-chat__footer { position: fixed !important; bottom: 0; width: 100vw; z-index: 99999; background: #fff; }
      .n8n-chat__input { font-size: 1.05rem !important; }
    }

    /* Visible status / error box */
    #chat-status {
      display:none;
      position: fixed;
      left: 50%;
      transform: translateX(-50%);
      top: 14px;
      z-index: 200000;
      background: #fff4c2;
      color: #6a4b00;
      padding: 10px 14px;
      border-radius: 8px;
      box-shadow: 0 8px 30px rgba(0,0,0,0.2);
      max-width: calc(100% - 32px);
      font-size: 0.95rem;
      line-height: 1.2;
    }

    .muted-small { color: rgba(255,255,255,0.72); font-size:0.92rem; }
  </style>
</head>
<body>
  <div id="chat-status" role="status" aria-live="polite"></div>

  <header>
    <h1>Chatea con Adrian ü§ñ</h1>
    <p class="muted-small">Soporte y automatizaci√≥n ‚Äî disponible 24/7</p>
  </header>

  <main>
    <section class="left" aria-labelledby="intro-heading">
      <h2 id="intro-heading" style="color:var(--accent);margin-bottom:10px">Hola ‚Äî soy Adrian</h2>
      <p class="intro">Transformamos procesos t√©cnicos en soluciones digitales inteligentes. Soy Adrian, apasionado por la automatizaci√≥n, la infraestructura web y el dise√±o estrat√©gico. Usa el chat para hacer consultas o pedir ayuda.</p>

      <ul class="list" aria-hidden="false">
        <li>Integraci√≥n con n8n y flujos automatizados</li>
        <li>Soporte para dominios, DNS y despliegues</li>
        <li>Conexi√≥n con APIs, WhatsApp e Instagram</li>
      </ul>

      <div style="margin-top:16px;color:var(--muted);font-size:0.95rem">
        Consejo: si el chat no responde, revisa la consola (F12 ‚Üí Console / Network). Si ves errores CORS o "No 'Access-Control-Allow-Origin'" necesitas habilitar CORS en el endpoint o usar un proxy HTTPS.
      </div>
    </section>

    <aside class="right">
      <!-- Aqu√≠ se mostrar√° el widget de n8n chat -->
      <div class="chat-card" id="chat-root" aria-label="Chat con Adrian"></div>
    </aside>
  </main>

  <footer>¬© 2025 ServiExpres | Desarrollo web & Automatizaci√≥n inteligente</footer>

  <script type="module">
    import { createChat } from 'https://cdn.jsdelivr.net/npm/@n8n/chat/dist/chat.bundle.es.js';

    // Webhook p√∫blico en Render (aseg√∫rate que es exactamente la URL que copia el nodo Webhook en n8n)
    const webhookUrl = 'https://n8n-tx1r.onrender.com/webhook/29d89778-b129-4332-a8d8-4f3473a4516e/chat';

    const statusEl = document.getElementById('chat-status');

    function showStatus(html){
      statusEl.innerHTML = html;
      statusEl.style.display = 'block';
    }
    function hideStatus(){
      statusEl.style.display = 'none';
    }

    (async () => {
      // Evitar mixed content (si la p√°gina se sirve por https, el webhook debe ser https)
      if (location.protocol === 'https:' && webhookUrl.startsWith('http:')) {
        showStatus('<strong>ERROR:</strong> la URL del webhook usa HTTP mientras la p√°gina est√° en HTTPS. Usa la URL p√∫blica HTTPS del nodo Webhook en n8n.');
        console.error('Mixed content: webhook is http while page is https');
        return;
      }

      // Intento de comprobaci√≥n OPTIONS para detectar CORS temprano (no definitivo si el servidor no soporta OPTIONS)
      try {
        const res = await fetch(webhookUrl, { method: 'OPTIONS' });
        console.log('Preflight OPTIONS:', res.status, res.statusText);
        // si la respuesta no incluye Access-Control-Allow-Origin, el navegador fallar√° en la preflight al usar el widget
        const acao = res.headers.get('access-control-allow-origin');
        if (!acao) {
          showStatus('Aviso: el endpoint del webhook no devuelve Access-Control-Allow-Origin. Si el chat no funciona, agrega CORS o usa un proxy que inyecte esa cabecera.');
        } else {
          hideStatus();
        }
      } catch (err) {
        console.warn('OPTIONS check failed (posible CORS o endpoint inaccesible):', err);
        showStatus('Aviso: no se pudo verificar el webhook desde el navegador. Revisa la consola (F12 ‚Üí Network/Console) para ver el error exacto.');
      }

      // Inicializa el widget n8n Chat dentro del contenedor (el widget inyecta su UI en el body)
      try {
        createChat({
          webhookUrl,
          botName: 'Adrian',
          language: 'es',
          title: 'Chatea con Adrian ü§ñ',
          description: '¬°Hola! Soy Adrian. ¬øEn qu√© puedo ayudarte hoy?',
          inputPlaceholder: 'Escribe tu mensaje...',
          mobile: { alwaysShowInput: true }
        });
        console.log('Widget n8n Chat inicializado con webhook:', webhookUrl);
      } catch (err) {
        console.error('Error inicializando createChat:', err);
        showStatus('No se pudo inicializar el chat. Mira la consola (F12) para m√°s detalles.');
      }
    })();
  </script>
</body>
</html>
