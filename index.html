<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ServiExpres | Chatea con Adrian</title>

  <!-- Fuente -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">

  <!-- n8n Chat CSS -->
  <link href="https://cdn.jsdelivr.net/npm/@n8n/chat/dist/style.css" rel="stylesheet" />

  <style>
    :root { --azul:#0057B8; --azul-sec:#00AEEF; --blanco:#ffffff; --gris:#eef2f7; }
    *{box-sizing:border-box;margin:0;padding:0}
    html,body{height:100%;width:100%;font-family:'Inter',sans-serif;background:#16213e;color:var(--blanco)}
    body{min-height:100vh;min-width:100vw;position:relative}

    #lines-bg-canvas{position:fixed;inset:0;width:100vw;height:100vh;z-index:0;pointer-events:none}
    .overlay{background:rgba(10,30,60,0.82);min-height:100vh;display:flex;flex-direction:column;align-items:center;padding-bottom:4rem;position:relative;z-index:1}

    header{width:100%;max-width:900px;text-align:center;margin-top:3rem;padding:0 1rem}
    header h1{font-size:2.6rem;font-weight:700;margin-bottom:.4rem}
    header p{font-size:1.05rem;opacity:.95;margin-bottom:1rem}

    .top-botones{display:flex;gap:1rem;justify-content:center;flex-wrap:wrap;margin-bottom:2rem}
    .top-botones a{display:inline-flex;align-items:center;gap:.5rem;background:var(--blanco);color:var(--azul);padding:.55rem 1rem;border-radius:999px;font-weight:600;text-decoration:none;border:2px solid var(--azul);box-shadow:0 3px 14px rgba(0,0,0,0.08)}
    .top-botones a:hover{background:var(--azul-sec);color:#fff}

    .contenido{width:100%;max-width:900px;background:rgba(255,255,255,0.06);border-radius:18px;padding:2rem;margin-bottom:2.4rem;box-shadow:0 6px 30px rgba(0,0,0,0.18);display:flex;flex-direction:column;align-items:center}
    .contenido h2{color:var(--azul-sec);font-size:1.8rem;margin-bottom:.8rem}
    .contenido p{line-height:1.6;margin-bottom:1rem;color:rgba(255,255,255,0.95)}
    .contenido ul{list-style:none;padding:0;max-width:640px;text-align:left;font-size:1.02rem}
    .contenido li{padding-left:1.6rem;margin-bottom:.65rem;position:relative}
    .contenido li::before{content:"‚úÖ";position:absolute;left:0}

    footer{width:100%;text-align:center;color:var(--gris);font-size:.95rem;margin-bottom:1rem}

    /* Widget mobile fix */
    .n8n-chat__footer,.n8n-chat__input,.n8n-chat__send{display:block!important;opacity:1!important}
    @media(max-width:600px){ .n8n-chat__footer{position:fixed!important;bottom:0;width:100vw;z-index:999999;background:#fff} .n8n-chat__input{font-size:1.05rem!important} }

    /* Mensajes de estado */
    #chat-status{display:none;position:fixed;left:50%;transform:translateX(-50%);top:1rem;z-index:999999;background:#fff4c2;color:#6a4b00;padding:.8rem 1rem;border-radius:8px;box-shadow:0 8px 30px rgba(0,0,0,0.18);max-width:calc(100% - 2rem);font-size:.95rem;line-height:1.2}
  </style>
</head>
<body>
  <div id="chat-status" role="status" aria-live="polite"></div>

  <canvas id="lines-bg-canvas"></canvas>

  <div class="overlay">
    <header>
      <h1>ServiExpres</h1>
      <p>Transformamos procesos t√©cnicos en soluciones digitales inteligentes</p>

      <div class="top-botones" aria-hidden="false">
        <a href="https://wa.me/573232864625" target="_blank" rel="noopener">üì± WhatsApp</a>
        <a href="https://www.instagram.com/finazas_organizadas/" target="_blank" rel="noopener">üì∏ Instagram</a>
        <a href="mailto:Gerencia@serviexpres.co">‚úâÔ∏è Correo</a>
      </div>
    </header>

    <main class="contenido" role="main">
      <h2>¬øQui√©n soy?</h2>
      <p>Soy Adri√°n, un apasionado por la automatizaci√≥n, infraestructura web y dise√±o estrat√©gico. Combino creatividad con precisi√≥n t√©cnica para ayudar a que los negocios digitales avancen con impacto y profesionalismo.</p>

      <h2>Lo que hago</h2>
      <ul>
        <li>Automatizaci√≥n con n8n y Docker</li>
        <li>Configuraci√≥n profesional de dominios, DNS y GitHub Pages</li>
        <li>Integraci√≥n de WhatsApp, Instagram y chatbots personalizados</li>
        <li>Dise√±o de landing pages efectivas con HTML y CSS</li>
        <li>Campa√±as de productos digitales como plantillas financieras</li>
      </ul>
    </main>

    <footer>¬© 2025 ServiExpres | Desarrollo web & Automatizaci√≥n inteligente</footer>
  </div>

  <script>
    // Fondo animado
    const canvas = document.getElementById('lines-bg-canvas');
    const ctx = canvas.getContext('2d');
    let w = window.innerWidth, h = window.innerHeight;
    function resize(){ w = window.innerWidth; h = window.innerHeight; canvas.width = w; canvas.height = h; }
    window.addEventListener('resize', resize);
    resize();
    const POINTS = 45, SPEED = 0.16, DIST = 140;
    const nodes = [];
    function rand(a,b){ return a + Math.random()*(b-a); }
    for(let i=0;i<POINTS;i++) nodes.push({ x: rand(0,w), y: rand(0,h), vx: rand(-SPEED,SPEED), vy: rand(-SPEED,SPEED) });
    function animate(){
      ctx.clearRect(0,0,w,h);
      for(let i=0;i<POINTS;i++){
        for(let j=i+1;j<POINTS;j++){
          const a = nodes[i], b = nodes[j];
          const dx = a.x - b.x, dy = a.y - b.y, d = Math.hypot(dx,dy);
          if(d < DIST){ ctx.save(); ctx.globalAlpha = 1 - d / DIST; ctx.strokeStyle = '#00AEEF'; ctx.lineWidth = 1.1; ctx.beginPath(); ctx.moveTo(a.x,a.y); ctx.lineTo(b.x,b.y); ctx.stroke(); ctx.restore(); }
        }
      }
      for(let i=0;i<POINTS;i++){
        const n = nodes[i];
        ctx.save(); ctx.globalAlpha = 0.65; ctx.beginPath(); ctx.arc(n.x,n.y,2.7,0,Math.PI*2); ctx.fillStyle = '#00AEEF'; ctx.shadowColor = '#00AEEF'; ctx.shadowBlur = 8; ctx.fill(); ctx.restore();
        n.x += n.vx; n.y += n.vy;
        if(n.x < 0 || n.x > w) n.vx = -n.vx;
        if(n.y < 0 || n.y > h) n.vy = -n.vy;
      }
      requestAnimationFrame(animate);
    }
    animate();
  </script>

  <script type="module">
    import { createChat } from 'https://cdn.jsdelivr.net/npm/@n8n/chat/dist/chat.bundle.es.js';

    // ---------- CONFIGURA AQU√ç ----------
    // Opci√≥n A (Producci√≥n): usar la URL p√∫blica HTTPS de n8n en Render
    const webhookUrlRender = 'https://n8n-tx1r.onrender.com/webhook/29d89778-b129-4332-a8d8-4f3473a4516e/chat';
    // Opci√≥n B (Local testing): usar n8n local
    const webhookUrlLocal = 'http://localhost:5678/webhook/29d89778-b129-4332-a8d8-4f3473a4516e/chat';
    // Selecciona la que corresponda a tu entorno:
    // Si la p√°gina la sirves por HTTPS en producci√≥n usa webhookUrlRender.
    // Si pruebas en local y sirves la p√°gina por HTTP usa webhookUrlLocal.
    const webhookUrl = (location.protocol === 'https:') ? webhookUrlRender : webhookUrlLocal;
    // ------------------------------------

    const statusEl = document.getElementById('chat-status');
    function showStatus(msg){ statusEl.innerHTML = msg; statusEl.style.display = 'block'; }
    function hideStatus(){ statusEl.style.display = 'none'; }

    (async () => {
      // 1) Evitar mixed content: si p√°gina HTTPS y webhook HTTP -> avisar y parar
      if (location.protocol === 'https:' && webhookUrl.startsWith('http:')) {
        showStatus('<strong>ERROR:</strong> la URL del webhook usa <code>http</code> mientras la p√°gina est√° en <code>https</code>. ' +
                   'Usa la URL p√∫blica HTTPS de n8n en Render o exp√≥n tu n8n local con HTTPS (ngrok).');
        console.error('Mixed content: webhook is http while page is https');
        return;
      }

      // 2) Intentar comprobaci√≥n OPTIONS/preflight (suelta aviso si no es alcanzable)
      let reachable = false;
      try {
        const res = await fetch(webhookUrl, { method: 'OPTIONS' });
        console.log('OPTIONS status:', res.status, res.statusText);
        if (res.status >= 200 && res.status < 400) reachable = true;
      } catch (err) {
        console.warn('OPTIONS check failed (possible CORS or endpoint not accessible):', err);
      }

      if (!reachable) {
        showStatus('Aviso: no se pudo verificar el webhook desde este navegador. Si el chat no funciona revisa la consola (F12 ‚Üí Network/Console), CORS, autenticaci√≥n y que el workflow est√© activo en n8n.');
      } else {
        hideStatus();
      }

      // 3) Inicializar widget (la librer√≠a maneja la comunicaci√≥n internamente)
      try {
        createChat({
          webhookUrl,
          botName: 'Adrian',
          language: 'es',
          title: 'Chatea con Adrian ü§ñ',
          description: '¬°Hola! Soy Adrian. ¬øEn qu√© puedo ayudarte hoy?',
          inputPlaceholder: 'Escribe tu mensaje...',
          mobile: { alwaysShowInput: true }
        });
        console.log('n8n Chat widget inicializado con webhook:', webhookUrl);
      } catch (err) {
        console.error('Error inicializando createChat:', err);
        showStatus('No se pudo inicializar el chat. Mira la consola para m√°s detalles.');
      }

      // 4) (Opcional) Prueba r√°pida POST desde el navegador (no para producci√≥n)
      // -> Si quieres descomenta y √∫sala temporalmente para comprobar que POST tiene respuesta:
      /*
      try {
        const r = await fetch(webhookUrl, { method: 'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify({test:'ping'}) });
        console.log('POST test status:', r.status, await r.text());
      } catch(e) { console.warn('POST test failed:', e); }
      */
    })();
  </script>
</body>
</html>
